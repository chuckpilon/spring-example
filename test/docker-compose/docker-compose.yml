version: '3.7'

services:

  activemq:
    # docker run -p 61616:61616 -p 8161:8161 rmohr/activemq:5.15.9
    image: rmohr/activemq:5.15.9
    container_name: activemq
    restart: always
    ports:
      - 61616:61616 
      - 8161:8161

  postgres:
    image: spring-example-db:latest
    container_name: spring-example-db
    restart: always
    environment:
      POSTGRES_PASSWORD: postgres
    ports:
      - 5432:5432

  discovery:
    image: spring-example-discovery:latest
    container_name: spring-example-discovery
    ports:
      - 8761:8761
    environment:
      OPTS: --eureka.client.registerWithEureka=true --eureka.client.fetchRegistry=true
        --eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka/

  item: 
    image: spring-example-item:latest
    container_name: spring-example-item
    ports:
      - 8081:8081
      - 5001:5001
    environment:
      JAVAOPTS: -agentlib:jdwp=transport=dt_socket,server=y,address=5001,suspend=n
      OPTS: --spring.datasource.url=jdbc:postgresql://postgres:5432/postgres 
        --eureka.client.serviceUrl.defaultZone=http://discovery:8761/eureka/
        --spring.jpa.show-sql=true
        --spring.jpa.properties.hibernate.format_sql=true
        --jms.host=activemq
        --jms.port=61616